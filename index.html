<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ماشین حساب ابجد حرفه‌ای - محاسبه ارزش عددی حروف</title>
  <meta name="description" content="محاسبه ابجد در زبان‌های فارسی، عربی، انگلیسی و عبری با روش‌های مختلف و منابع علمی معتبر">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    @import url('https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css');
    
    :root {
      --primary: #5e35b1;
      --primary-light: #7e57c2;
      --primary-dark: #4527a0;
      --secondary: #00897b;
      --accent: #ff5722;
      --success: #4caf50;
      --warning: #ff9800;
      --error: #f44336;
      --dark: #212121;
      --gray-dark: #424242;
      --gray: #9e9e9e;
      --gray-light: #e0e0e0;
      --light: #fafafa;
      --white: #ffffff;
      --shadow: 0 2px 4px rgba(0,0,0,0.1);
      --shadow-lg: 0 8px 16px rgba(0,0,0,0.15);
      --radius: 8px;
      --radius-lg: 16px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Vazir', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--light);
      color: var(--dark);
      line-height: 1.6;
      transition: var(--transition);
    }
    
    body.dark-theme {
      --light: #121212;
      --white: #1e1e1e;
      --dark: #e0e0e0;
      --gray-light: #424242;
      --gray-dark: #bdbdbd;
      background-color: #121212;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 40px 20px;
      text-align: center;
      border-radius: var(--radius-lg);
      margin-bottom: 30px;
      box-shadow: var(--shadow-lg);
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .subtitle {
      font-size: 1.1rem;
      opacity: 0.95;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 25px;
      margin-bottom: 30px;
    }
    
    @media (max-width: 1024px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .card {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: 25px;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }
    
    .card:hover {
      box-shadow: var(--shadow-lg);
    }
    
    .card-title {
      font-size: 1.4rem;
      margin-bottom: 20px;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--gray-light);
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    label {
      font-weight: 500;
      margin-bottom: 8px;
      color: var(--gray-dark);
      font-size: 0.95rem;
    }
    
    input, select, textarea {
      padding: 12px 16px;
      border: 2px solid var(--gray-light);
      border-radius: var(--radius);
      font-size: 1rem;
      font-family: inherit;
      transition: var(--transition);
      background: var(--white);
      color: var(--dark);
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(94, 53, 177, 0.1);
    }
    
    textarea {
      resize: vertical;
      min-height: 120px;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      border: none;
      border-radius: var(--radius);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      font-family: inherit;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    
    .btn-secondary {
      background: var(--secondary);
      color: white;
    }
    
    .btn-secondary:hover {
      background: #00695c;
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }
    
    .btn-sm {
      padding: 8px 16px;
      font-size: 0.9rem;
    }
    
    .btn-icon {
      width: 40px;
      height: 40px;
      padding: 0;
      border-radius: 50%;
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .result-display {
      background: linear-gradient(135deg, #e3f2fd 0%, #e1f5fe 100%);
      border-radius: var(--radius-lg);
      padding: 30px;
      text-align: center;
      margin-bottom: 25px;
    }
    
    .dark-theme .result-display {
      background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
    }
    
    .result-value {
      font-size: 4rem;
      font-weight: 800;
      color: var(--primary);
      margin: 20px 0;
      animation: fadeInScale 0.5s ease-out;
    }
    
    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .result-text {
      font-size: 1.5rem;
      color: var(--gray-dark);
      margin-bottom: 10px;
    }
    
    .result-method {
      color: var(--secondary);
      font-weight: 500;
    }
    
    .breakdown-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 12px;
      margin-top: 20px;
    }
    
    .letter-card {
      background: var(--white);
      border: 2px solid var(--gray-light);
      border-radius: var(--radius);
      padding: 15px;
      text-align: center;
      transition: var(--transition);
      cursor: default;
    }
    
    .letter-card:hover {
      transform: translateY(-3px);
      border-color: var(--primary);
      box-shadow: var(--shadow);
    }
    
    .letter {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 5px;
    }
    
    .letter-value {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--gray-dark);
    }
    
    .analysis-section {
      background: #f3e5f5;
      border-radius: var(--radius);
      padding: 20px;
      margin-top: 20px;
    }
    
    .dark-theme .analysis-section {
      background: #4a148c;
    }
    
    .analysis-title {
      font-size: 1.2rem;
      color: var(--primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .meaning-badge {
      display: inline-block;
      padding: 8px 16px;
      background: var(--primary);
      color: white;
      border-radius: 20px;
      font-size: 0.95rem;
      margin: 5px;
    }
    
    .history-item {
      background: var(--light);
      border-radius: var(--radius);
      padding: 15px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 4px solid var(--primary);
      transition: var(--transition);
    }
    
    .history-item:hover {
      transform: translateX(-5px);
      box-shadow: var(--shadow);
    }
    
    .history-text {
      font-weight: 500;
      font-size: 1.1rem;
    }
    
    .history-info {
      text-align: left;
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: 5px;
    }
    
    .history-value {
      background: var(--primary);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 1.1rem;
    }
    
    .custom-pattern-form {
      background: var(--light);
      border-radius: var(--radius);
      padding: 20px;
      margin-top: 20px;
      display: none;
    }
    
    .custom-pattern-form.active {
      display: block;
    }
    
    .pattern-row {
      display: grid;
      grid-template-columns: 1fr 2fr auto;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
    }
    
    .pattern-row input {
      padding: 8px 12px;
    }
    
    .btn-remove {
      background: var(--error);
      color: white;
      width: 36px;
      height: 36px;
    }
    
    .chart-container {
      position: relative;
      height: 300px;
      margin-top: 25px;
    }
    
    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--gray-light);
    }
    
    .tab {
      padding: 10px 20px;
      background: transparent;
      border: none;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      color: var(--gray);
      transition: var(--transition);
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
    }
    
    .tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .comparison-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .comparison-card {
      background: var(--light);
      border-radius: var(--radius);
      padding: 20px;
      text-align: center;
      border: 2px solid var(--gray-light);
    }
    
    .comparison-method {
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 10px;
    }
    
    .comparison-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--secondary);
    }
    
    .footer {
      text-align: center;
      padding: 30px 20px;
      margin-top: 50px;
      border-top: 1px solid var(--gray-light);
      color: var(--gray);
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    .footer-links a {
      color: var(--primary);
      text-decoration: none;
      transition: var(--transition);
    }
    
    .footer-links a:hover {
      text-decoration: underline;
    }
    
    .notification {
      position: fixed;
      bottom: 30px;
      right: 30px;
      padding: 16px 24px;
      background: var(--success);
      color: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      transform: translateY(100px);
      opacity: 0;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .loader {
      display: none;
      width: 40px;
      height: 40px;
      border: 4px solid var(--gray-light);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: var(--gray);
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 15px;
      opacity: 0.5;
    }
    
    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }
      
      .result-value {
        font-size: 3rem;
      }
      
      .main-grid {
        gap: 20px;
      }
      
      .card {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header>
      <h1><i class="fas fa-calculator"></i> ماشین حساب ابجد حرفه‌ای</h1>
      <p class="subtitle">محاسبه ارزش عددی حروف در زبان‌های فارسی، عربی، انگلیسی و عبری با روش‌های مختلف علمی</p>
    </header>
    
    <!-- Main Content -->
    <div class="main-grid">
      <!-- Input Section -->
      <div class="card">
        <h2 class="card-title">
          <i class="fas fa-keyboard"></i>
          ورودی و تنظیمات
        </h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="language">زبان محاسبه:</label>
            <select id="language">
              <option value="fa">فارسی</option>
              <option value="ar">عربی</option>
              <option value="en">انگلیسی</option>
              <option value="he">عبری</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="method">روش محاسبه:</label>
            <select id="method">
              <!-- Options will be populated dynamically -->
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label for="input-text">متن ورودی:</label>
          <textarea id="input-text" placeholder="متن خود را وارد کنید..."></textarea>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-primary" id="calculate-btn">
            <i class="fas fa-calculator"></i>
            محاسبه ابجد
          </button>
          <button class="btn btn-secondary" id="compare-btn">
            <i class="fas fa-chart-bar"></i>
            مقایسه روش‌ها
          </button>
          <button class="btn btn-outline" id="clear-btn">
            <i class="fas fa-eraser"></i>
            پاک کردن
          </button>
        </div>
        
        <!-- Custom Pattern Section -->
        <div style="margin-top: 20px;">
          <button class="btn btn-outline btn-sm" id="toggle-custom-pattern">
            <i class="fas fa-plus"></i>
            ایجاد الگوی سفارشی
          </button>
          
          <div class="custom-pattern-form" id="custom-pattern-form">
            <h3 style="margin-bottom: 15px;">تعریف الگوی سفارشی</h3>
            <div id="pattern-rows"></div>
            <button class="btn btn-secondary btn-sm" id="add-pattern-row">
              <i class="fas fa-plus"></i>
              افزودن حرف
            </button>
            <button class="btn btn-primary btn-sm" id="save-pattern" style="margin-right: 10px;">
              <i class="fas fa-save"></i>
              ذخیره الگو
            </button>
          </div>
        </div>
      </div>
      
      <!-- Results Section -->
      <div class="card">
        <h2 class="card-title">
          <i class="fas fa-poll"></i>
          نتایج محاسبه
        </h2>
        
        <div id="result-container">
          <div class="empty-state">
            <i class="fas fa-info-circle"></i>
            <p>متنی برای محاسبه وارد کنید</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Analysis Section -->
    <div class="card" id="analysis-section" style="display: none;">
      <h2 class="card-title">
        <i class="fas fa-chart-line"></i>
        تحلیل و مقایسه
      </h2>
      
      <div class="tabs">
        <button class="tab active" data-tab="breakdown">تفکیک حروف</button>
        <button class="tab" data-tab="comparison">مقایسه روش‌ها</button>
        <button class="tab" data-tab="chart">نمودار</button>
        <button class="tab" data-tab="meanings">معانی عددی</button>
      </div>
      
      <div class="tab-content active" id="breakdown-tab">
        <div id="breakdown-content"></div>
      </div>
      
      <div class="tab-content" id="comparison-tab">
        <div id="comparison-content"></div>
      </div>
      
      <div class="tab-content" id="chart-tab">
        <div class="chart-container">
          <canvas id="abjad-chart"></canvas>
        </div>
      </div>
      
      <div class="tab-content" id="meanings-tab">
        <div id="meanings-content"></div>
      </div>
    </div>
    
    <!-- History Section -->
    <div class="card">
      <h2 class="card-title">
        <i class="fas fa-history"></i>
        تاریخچه محاسبات
      </h2>
      
      <div id="history-container">
        <div class="empty-state">
          <i class="fas fa-clock"></i>
          <p>هنوز محاسبه‌ای انجام نشده است</p>
        </div>
      </div>
      
      <button class="btn btn-outline btn-sm" id="clear-history" style="margin-top: 15px;">
        <i class="fas fa-trash"></i>
        پاک کردن تاریخچه
      </button>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
      <p>&copy; 1403 - ماشین حساب ابجد حرفه‌ای</p>
      <div class="footer-links">
        <a href="#" onclick="showReferences()">منابع علمی</a>
        <a href="#" onclick="showAbout()">درباره</a>
        <a href="#" onclick="showHelp()">راهنما</a>
      </div>
    </footer>
  </div>
  
  <!-- Notification -->
  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notification-text">عملیات با موفقیت انجام شد</span>
  </div>
  
  <!-- Theme Toggle -->
  <button class="btn btn-icon" id="theme-toggle" style="position: fixed; top: 20px; left: 20px;">
    <i class="fas fa-moon"></i>
  </button>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script>
    // Calculation Methods Data
    const calculationMethods = {
      fa: {
        classic: {
          name: "ابجد کلاسیک",
          values: {
            'ا': 1, 'ب': 2, 'پ': 2, 'ت': 400, 'ث': 500, 'ج': 3, 'چ': 3,
            'ح': 8, 'خ': 600, 'د': 4, 'ذ': 700, 'ر': 200, 'ز': 7, 'ژ': 7,
            'س': 60, 'ش': 300, 'ص': 90, 'ض': 800, 'ط': 9, 'ظ': 900,
            'ع': 70, 'غ': 1000, 'ف': 80, 'ق': 100, 'ک': 20, 'گ': 20,
            'ل': 30, 'م': 40, 'ن': 50, 'و': 6, 'ه': 5, 'ی': 10
          }
        },
        numerical: {
          name: "عددی ساده",
          values: {
            'ا': 1, 'ب': 2, 'پ': 3, 'ت': 4, 'ث': 5, 'ج': 6, 'چ': 7,
            'ح': 8, 'خ': 9, 'د': 10, 'ذ': 11, 'ر': 12, 'ز': 13, 'ژ': 14,
            'س': 15, 'ش': 16, 'ص': 17, 'ض': 18, 'ط': 19, 'ظ': 20,
            'ع': 21, 'غ': 22, 'ف': 23, 'ق': 24, 'ک': 25, 'گ': 26,
            'ل': 27, 'م': 28, 'ن': 29, 'و': 30, 'ه': 31, 'ی': 32
          }
        },
        mystical: {
          name: "عرفانی",
          values: {
            'ا': 1, 'ب': 2, 'پ': 80, 'ت': 400, 'ث': 600, 'ج': 3, 'چ': 300,
            'ح': 8, 'خ': 60, 'د': 4, 'ذ': 700, 'ر': 200, 'ز': 7, 'ژ': 3000,
            'س': 60, 'ش': 400, 'ص': 70, 'ض': 800, 'ط': 90, 'ظ': 900,
            'ع': 100, 'غ': 1000, 'ف': 80, 'ق': 100, 'ک': 20, 'گ': 30,
            'ل': 30, 'م': 40, 'ن': 50, 'و': 6, 'ه': 5, 'ی': 10
          }
        }
      },
      ar: {
        classic: {
          name: "ابجد کلاسیک",
          values: {
            'ا': 1, 'ب': 2, 'ت': 400, 'ث': 500, 'ج': 3, 'ح': 8, 'خ': 600,
            'د': 4, 'ذ': 700, 'ر': 200, 'ز': 7, 'س': 60, 'ش': 300,
            'ص': 90, 'ض': 800, 'ط': 9, 'ظ': 900, 'ع': 70, 'غ': 1000,
            'ف': 80, 'ق': 100, 'ك': 20, 'ل': 30, 'م': 40, 'ن': 50,
            'ه': 5, 'و': 6, 'ي': 10, 'ى': 10, 'ء': 0, 'أ': 1, 'إ': 1,
            'آ': 1, 'ؤ': 6, 'ئ': 1, 'ة': 5
          }
        },
        atbash: {
          name: "معکوس (Atbash)",
          values: {
            'ا': 400, 'ب': 300, 'ت': 200, 'ث': 100, 'ج': 90, 'ح': 80, 'خ': 70,
            'د': 60, 'ذ': 50, 'ر': 40, 'ز': 30, 'س': 20, 'ش': 10,
            'ص': 9, 'ض': 8, 'ط': 7, 'ظ': 6, 'ع': 5, 'غ': 4,
            'ف': 3, 'ق': 2, 'ك': 1, 'ل': 1000, 'م': 900, 'ن': 800,
            'ه': 700, 'و': 600, 'ي': 500
          }
        },
        modern: {
          name: "مدرن",
          values: {
            'ا': 1, 'ب': 2, 'ت': 3, 'ث': 4, 'ج': 5, 'ح': 6, 'خ': 7,
            'د': 8, 'ذ': 9, 'ر': 10, 'ز': 11, 'س': 12, 'ش': 13,
            'ص': 14, 'ض': 15, 'ط': 16, 'ظ': 17, 'ع': 18, 'غ': 19,
            'ف': 20, 'ق': 21, 'ك': 22, 'ل': 23, 'م': 24, 'ن': 25,
            'ه': 26, 'و': 27, 'ي': 28
          }
        }
      },
      en: {
        classic: {
          name: "کلاسیک (A=1)",
          values: {
            'A': 1, 'B': 2, 'C': 3, 'D': 4, 'E': 5, 'F': 6, 'G': 7,
            'H': 8, 'I': 9, 'J': 10, 'K': 11, 'L': 12, 'M': 13,
            'N': 14, 'O': 15, 'P': 16, 'Q': 17, 'R': 18, 'S': 19,
            'T': 20, 'U': 21, 'V': 22, 'W': 23, 'X': 24, 'Y': 25,
            'Z': 26, 'a': 1, 'b': 2, 'c': 3, 'd': 4, 'e': 5, 'f': 6,
            'g': 7, 'h': 8, 'i': 9, 'j': 10, 'k': 11, 'l': 12,
            'm': 13, 'n': 14, 'o': 15, 'p': 16, 'q': 17, 'r': 18,
            's': 19, 't': 20, 'u': 21, 'v': 22, 'w': 23, 'x': 24,
            'y': 25, 'z': 26
          }
        },
        kabbalah: {
          name: "کابالا",
          values: {
            'A': 1, 'B': 2, 'C': 3, 'D': 4, 'E': 5, 'F': 6, 'G': 7,
            'H': 8, 'I': 9, 'J': 10, 'K': 20, 'L': 30, 'M': 40,
            'N': 50, 'O': 60, 'P': 70, 'Q': 80, 'R': 90, 'S': 100,
            'T': 200, 'U': 300, 'V': 400, 'W': 500, 'X': 600, 'Y': 700,
            'Z': 800, 'a': 1, 'b': 2, 'c': 3, 'd': 4, 'e': 5, 'f': 6,
            'g': 7, 'h': 8, 'i': 9, 'j': 10, 'k': 20, 'l': 30,
            'm': 40, 'n': 50, 'o': 60, 'p': 70, 'q': 80, 'r': 90,
            's': 100, 't': 200, 'u': 300, 'v': 400, 'w': 500, 'x': 600,
            'y': 700, 'z': 800
          }
        },
        reverse: {
          name: "معکوس (A=26)",
          values: {
            'A': 26, 'B': 25, 'C': 24, 'D': 23, 'E': 22, 'F': 21, 'G': 20,
            'H': 19, 'I': 18, 'J': 17, 'K': 16, 'L': 15, 'M': 14,
            'N': 13, 'O': 12, 'P': 11, 'Q': 10, 'R': 9, 'S': 8,
            'T': 7, 'U': 6, 'V': 5, 'W': 4, 'X': 3, 'Y': 2,
            'Z': 1, 'a': 26, 'b': 25, 'c': 24, 'd': 23, 'e': 22, 'f': 21,
            'g': 20, 'h': 19, 'i': 18, 'j': 17, 'k': 16, 'l': 15,
            'm': 14, 'n': 13, 'o': 12, 'p': 11, 'q': 10, 'r': 9,
            's': 8, 't': 7, 'u': 6, 'v': 5, 'w': 4, 'x': 3,
            'y': 2, 'z': 1
          }
        }
      },
      he: {
        classic: {
          name: "گماتریا کلاسیک",
          values: {
            'א': 1, 'ב': 2, 'ג': 3, 'ד': 4, 'ה': 5, 'ו': 6, 'ז': 7, 'ח': 8, 'ט': 9,
            'י': 10, 'כ': 20, 'ך': 20, 'ל': 30, 'מ': 40, 'ם': 40, 'נ': 50, 'ן': 50,
            'ס': 60, 'ע': 70, 'פ': 80, 'ף': 80, 'צ': 90, 'ץ': 90, 'ק': 100,
            'ר': 200, 'ש': 300, 'ת': 400
          }
        },
        atbash: {
          name: "معکوس (Atbash)",
          values: {
            'א': 400, 'ב': 300, 'ג': 200, 'ד': 100, 'ה': 90, 'ו': 80, 'ז': 70,
            'ח': 60, 'ט': 50, 'י': 40, 'כ': 30, 'ך': 30, 'ל': 20, 'מ': 10, 'ם': 10,
            'נ': 9, 'ן': 9, 'ס': 8, 'ע': 7, 'פ': 6, 'ף': 6, 'צ': 5, 'ץ': 5,
            'ק': 4, 'ר': 3, 'ש': 2, 'ת': 1
          }
        },
        mystic: {
          name: "صوفیانه",
          values: {
            'א': 111, 'ב': 412, 'ג': 83, 'ד': 434, 'ה': 6, 'ו': 22, 'ז': 77, 'ח': 418,
            'ט': 419, 'י': 20, 'כ': 100, 'ך': 500, 'ל': 74, 'מ': 90, 'ם': 600,
            'נ': 106, 'ן': 756, 'ס': 120, 'ע': 130, 'פ': 81, 'ף': 801,
            'צ': 104, 'ץ': 904, 'ק': 186, 'ר': 510, 'ש': 360, 'ת': 406
          }
        }
      }
    };
    
    // Number meanings
    const numberMeanings = {
      1: { primary: "یکتایی، آغاز", secondary: "وحدت، خلاقیت، رهبری", color: "#e74c3c" },
      2: { primary: "دوگانگی، تعادل", secondary: "همکاری، شراکت، دیپلماسی", color: "#3498db" },
      3: { primary: "خلاقیت، بیان", secondary: "ارتباط، شادی، الهام", color: "#f39c12" },
      4: { primary: "ثبات، نظم", secondary: "کار سخت، قابل اعتماد بودن", color: "#27ae60" },
      5: { primary: "آزادی، تغییر", secondary: "ماجراجویی، تنوع، پیشرفت", color: "#e67e22" },
      6: { primary: "هارمونی، مسئولیت", secondary: "عشق، خانواده، شفا", color: "#9b59b6" },
      7: { primary: "معنویت، تأمل", secondary: "حکمت، درون‌بینی، عرفان", color: "#8e44ad" },
      8: { primary: "قدرت، موفقیت", secondary: "ثروت، دستاورد، اقتدار", color: "#34495e" },
      9: { primary: "کمال، خدمت", secondary: "بشردوستی، جهانی بودن", color: "#16a085" },
      10: { primary: "تکمیل، آغاز نو", secondary: "رهبری، استقلال", color: "#2c3e50" },
      11: { primary: "بینش، الهام", secondary: "معنویت، شهود، روشنایی", color: "#f1c40f" },
      12: { primary: "کمال، چرخه", secondary: "خلاقیت، همکاری", color: "#e74c3c" },
      13: { primary: "تحول، دگرگونی", secondary: "قدرت، تولد دوباره", color: "#95a5a6" },
      22: { primary: "استاد سازنده", secondary: "رویای بزرگ، دستاورد", color: "#d35400" },
      33: { primary: "استاد معلم", secondary: "عشق جهانی، شفا", color: "#c0392b" }
    };
    
    // App State
    let currentLanguage = 'fa';
    let currentMethod = 'classic';
    let customPatterns = JSON.parse(localStorage.getItem('customPatterns')) || {};
    let history = JSON.parse(localStorage.getItem('abjadHistory')) || [];
    let chart = null;
    
    // DOM Elements
    const languageSelect = document.getElementById('language');
    const methodSelect = document.getElementById('method');
    const inputText = document.getElementById('input-text');
    const calculateBtn = document.getElementById('calculate-btn');
    const compareBtn = document.getElementById('compare-btn');
    const clearBtn = document.getElementById('clear-btn');
    const themeToggle = document.getElementById('theme-toggle');
    const resultContainer = document.getElementById('result-container');
    const analysisSection = document.getElementById('analysis-section');
    const historyContainer = document.getElementById('history-container');
    const clearHistoryBtn = document.getElementById('clear-history');
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notification-text');
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      populateMethods();
      renderHistory();
      initializeTabs();
      initializeCustomPattern();
      loadTheme();
    });
    
    // Theme Management
    function loadTheme() {
      const isDark = localStorage.getItem('darkTheme') === 'true';
      if (isDark) {
        document.body.classList.add('dark-theme');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
      }
    }
    
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-theme');
      const isDark = document.body.classList.contains('dark-theme');
      localStorage.setItem('darkTheme', isDark);
      themeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    });
    
    // Language and Method Management
    languageSelect.addEventListener('change', () => {
      currentLanguage = languageSelect.value;
      populateMethods();
    });
    
    methodSelect.addEventListener('change', () => {
      currentMethod = methodSelect.value;
    });
    
    function populateMethods() {
      methodSelect.innerHTML = '';
      const methods = calculationMethods[currentLanguage];
      
      for (const [key, method] of Object.entries(methods)) {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = method.name;
        methodSelect.appendChild(option);
      }
      
      // Add custom patterns
      const customForLang = customPatterns[currentLanguage];
      if (customForLang) {
        for (const [name, values] of Object.entries(customForLang)) {
          const option = document.createElement('option');
          option.value = `custom_${name}`;
          option.textContent = `${name} (سفارشی)`;
          methodSelect.appendChild(option);
        }
      }
      
      currentMethod = methodSelect.value;
    }
    
    // Calculation Functions
    function calculate(text, language, method) {
      let values;
      
      if (method.startsWith('custom_')) {
        const customName = method.replace('custom_', '');
        values = customPatterns[language][customName];
      } else {
        values = calculationMethods[language][method].values;
      }
      
      let total = 0;
      const breakdown = [];
      
      for (const char of text) {
        const value = values[char] || 0;
        if (value > 0) {
          total += value;
          breakdown.push({ char, value });
        }
      }
      
      return { total, breakdown };
    }
    
    function compareAllMethods(text, language) {
      const results = {};
      const methods = calculationMethods[language];
      
      for (const [key, method] of Object.entries(methods)) {
        results[key] = {
          name: method.name,
          ...calculate(text, language, key)
        };
      }
      
      // Include custom patterns
      const customForLang = customPatterns[language];
      if (customForLang) {
        for (const [name, values] of Object.entries(customForLang)) {
          results[`custom_${name}`] = {
            name: `${name} (سفارشی)`,
            ...calculate(text, language, `custom_${name}`)
          };
        }
      }
      
      return results;
    }
    
    // Event Handlers
    calculateBtn.addEventListener('click', () => {
      const text = inputText.value.trim();
      if (!text) {
        showNotification('لطفاً متنی وارد کنید', 'error');
        return;
      }
      
      const result = calculate(text, currentLanguage, currentMethod);
      displayResult(text, result);
      displayAnalysis(text, result);
      addToHistory(text, currentLanguage, currentMethod, result.total);
      showNotification('محاسبه با موفقیت انجام شد', 'success');
    });
    
    compareBtn.addEventListener('click', () => {
      const text = inputText.value.trim();
      if (!text) {
        showNotification('لطفاً متنی وارد کنید', 'error');
        return;
      }
      
      const results = compareAllMethods(text, currentLanguage);
      displayComparison(text, results);
      showNotification('مقایسه روش‌ها انجام شد', 'success');
    });
    
    clearBtn.addEventListener('click', () => {
      inputText.value = '';
      resultContainer.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-info-circle"></i>
          <p>متنی برای محاسبه وارد کنید</p>
        </div>
      `;
      analysisSection.style.display = 'none';
    });
    
    clearHistoryBtn.addEventListener('click', () => {
      if (confirm('آیا از پاک کردن تاریخچه اطمینان دارید؟')) {
        history = [];
        localStorage.removeItem('abjadHistory');
        renderHistory();
        showNotification('تاریخچه پاک شد', 'success');
      }
    });
    
    // Display Functions
    function displayResult(text, result) {
      const methodName = currentMethod.startsWith('custom_') 
        ? customPatterns[currentLanguage][currentMethod.replace('custom_', '')] + ' (سفارشی)'
        : calculationMethods[currentLanguage][currentMethod].name;
      
      resultContainer.innerHTML = `
        <div class="result-display">
          <div class="result-text">${text}</div>
          <div class="result-value">${result.total}</div>
          <div class="result-method">روش: ${methodName}</div>
        </div>
      `;
      
      analysisSection.style.display = 'block';
    }
    
    function displayAnalysis(text, result) {
      // Breakdown
      const breakdownHtml = `
        <div class="breakdown-grid">
          ${result.breakdown.map(item => `
            <div class="letter-card">
              <div class="letter">${item.char}</div>
              <div class="letter-value">${item.value}</div>
            </div>
          `).join('')}
        </div>
      `;
      document.getElementById('breakdown-content').innerHTML = breakdownHtml;
      
      // Meanings
      const meanings = getMeaningsForNumber(result.total);
      const meaningsHtml = `
        <div class="analysis-section">
          <h3 class="analysis-title">
            <i class="fas fa-book"></i>
            معانی عدد ${result.total}
          </h3>
          ${meanings.map(meaning => `
            <div class="meaning-badge" style="background-color: ${meaning.color}">
              ${meaning.text}
            </div>
          `).join('')}
        </div>
      `;
      document.getElementById('meanings-content').innerHTML = meaningsHtml;
      
      // Chart
      updateChart(result.breakdown);
    }
    
    function displayComparison(text, results) {
      const comparisonHtml = `
        <div class="comparison-grid">
          ${Object.entries(results).map(([key, result]) => `
            <div class="comparison-card">
              <div class="comparison-method">${result.name}</div>
              <div class="comparison-value">${result.total}</div>
            </div>
          `).join('')}
        </div>
      `;
      
      document.getElementById('comparison-content').innerHTML = comparisonHtml;
      
      // Switch to comparison tab
      document.querySelector('[data-tab="comparison"]').click();
    }
    
    function getMeaningsForNumber(number) {
      const meanings = [];
      
      // Direct meaning
      if (numberMeanings[number]) {
        meanings.push({
          text: `${numberMeanings[number].primary}: ${numberMeanings[number].secondary}`,
          color: numberMeanings[number].color
        });
      }
      
      // Reduced number (sum of digits)
      let reduced = number;
      while (reduced > 9 && reduced !== 11 && reduced !== 22 && reduced !== 33) {
        reduced = reduced.toString().split('').reduce((a, b) => a + parseInt(b), 0);
      }
      
      if (reduced !== number && numberMeanings[reduced]) {
        meanings.push({
          text: `عدد کاهش یافته ${reduced}: ${numberMeanings[reduced].primary}`,
          color: numberMeanings[reduced].color
        });
      }
      
      // Special properties
      if (isPrime(number)) {
        meanings.push({
          text: 'عدد اول',
          color: '#e74c3c'
        });
      }
      
      if (isPerfectSquare(number)) {
        meanings.push({
          text: `مربع کامل (${Math.sqrt(number)}²)`,
          color: '#3498db'
        });
      }
      
      return meanings;
    }
    
    function isPrime(n) {
      if (n <= 1) return false;
      for (let i = 2; i <= Math.sqrt(n); i++) {
        if (n % i === 0) return false;
      }
      return true;
    }
    
    function isPerfectSquare(n) {
      const sqrt = Math.sqrt(n);
      return sqrt === Math.floor(sqrt);
    }
    
    // Chart Functions
    function updateChart(breakdown) {
      const ctx = document.getElementById('abjad-chart').getContext('2d');
      
      if (chart) {
        chart.destroy();
      }
      
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: breakdown.map(item => item.char),
          datasets: [{
            label: 'ارزش ابجدی',
            data: breakdown.map(item => item.value),
            backgroundColor: 'rgba(94, 53, 177, 0.6)',
            borderColor: 'rgba(94, 53, 177, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            title: {
              display: true,
              text: 'توزیع ارزش حروف',
              font: {
                size: 16,
                family: 'Vazir'
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    // History Functions
    function addToHistory(text, language, method, total) {
      const entry = {
        text,
        language,
        method,
        total,
        timestamp: new Date().toISOString()
      };
      
      history.unshift(entry);
      if (history.length > 20) {
        history = history.slice(0, 20);
      }
      
      localStorage.setItem('abjadHistory', JSON.stringify(history));
      renderHistory();
    }
    
    function renderHistory() {
      if (history.length === 0) {
        historyContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-clock"></i>
            <p>هنوز محاسبه‌ای انجام نشده است</p>
          </div>
        `;
        return;
      }
      
      historyContainer.innerHTML = history.map(entry => {
        const date = new Date(entry.timestamp);
        const dateStr = date.toLocaleDateString('fa-IR');
        const timeStr = date.toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' });
        
        return `
          <div class="history-item" onclick="loadFromHistory('${entry.text}', '${entry.language}', '${entry.method}')">
            <div>
              <div class="history-text">${entry.text}</div>
              <div class="history-info">${getLanguageName(entry.language)} • ${dateStr} ${timeStr}</div>
            </div>
            <div class="history-value">${entry.total}</div>
          </div>
        `;
      }).join('');
    }
    
    function loadFromHistory(text, language, method) {
      inputText.value = text;
      languageSelect.value = language;
      currentLanguage = language;
      populateMethods();
      methodSelect.value = method;
      currentMethod = method;
      calculateBtn.click();
    }
    
    function getLanguageName(code) {
      const names = {
        'fa': 'فارسی',
        'ar': 'عربی',
        'en': 'انگلیسی',
        'he': 'عبری'
      };
      return names[code] || code;
    }
    
    // Tabs
    function initializeTabs() {
      const tabs = document.querySelectorAll('.tab');
      const contents = document.querySelectorAll('.tab-content');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const targetId = `${tab.dataset.tab}-tab`;
          
          tabs.forEach(t => t.classList.remove('active'));
          contents.forEach(c => c.classList.remove('active'));
          
          tab.classList.add('active');
          document.getElementById(targetId).classList.add('active');
        });
      });
    }
    
    // Custom Pattern
    function initializeCustomPattern() {
      const toggleBtn = document.getElementById('toggle-custom-pattern');
      const form = document.getElementById('custom-pattern-form');
      const addRowBtn = document.getElementById('add-pattern-row');
      const saveBtn = document.getElementById('save-pattern');
      const rowsContainer = document.getElementById('pattern-rows');
      
      toggleBtn.addEventListener('click', () => {
        form.classList.toggle('active');
        toggleBtn.innerHTML = form.classList.contains('active') 
          ? '<i class="fas fa-minus"></i> بستن فرم'
          : '<i class="fas fa-plus"></i> ایجاد الگوی سفارشی';
      });
      
      addRowBtn.addEventListener('click', () => {
        addPatternRow();
      });
      
      saveBtn.addEventListener('click', () => {
        saveCustomPattern();
      });
      
      // Add initial row
      addPatternRow();
    }
    
    function addPatternRow(char = '', value = '') {
      const rowsContainer = document.getElementById('pattern-rows');
      const row = document.createElement('div');
      row.className = 'pattern-row';
      row.innerHTML = `
        <input type="text" class="pattern-char" placeholder="حرف" maxlength="1" value="${char}">
        <input type="number" class="pattern-value" placeholder="ارزش" value="${value}">
        <button class="btn btn-icon btn-remove" onclick="this.parentElement.remove()">
          <i class="fas fa-times"></i>
        </button>
      `;
      rowsContainer.appendChild(row);
    }
    
    function saveCustomPattern() {
      const name = prompt('نام الگوی سفارشی:');
      if (!name) return;
      
      const rows = document.querySelectorAll('.pattern-row');
      const pattern = {};
      
      rows.forEach(row => {
        const char = row.querySelector('.pattern-char').value;
        const value = parseInt(row.querySelector('.pattern-value').value);
        
        if (char && !isNaN(value)) {
          pattern[char] = value;
        }
      });
      
      if (Object.keys(pattern).length === 0) {
        showNotification('لطفاً حداقل یک حرف و ارزش وارد کنید', 'error');
        return;
      }
      
      if (!customPatterns[currentLanguage]) {
        customPatterns[currentLanguage] = {};
      }
      
      customPatterns[currentLanguage][name] = pattern;
      localStorage.setItem('customPatterns', JSON.stringify(customPatterns));
      
      populateMethods();
      methodSelect.value = `custom_${name}`;
      currentMethod = methodSelect.value;
      
      showNotification('الگوی سفارشی ذخیره شد', 'success');
      
      // Clear form
      document.getElementById('pattern-rows').innerHTML = '';
      addPatternRow();
      document.getElementById('custom-pattern-form').classList.remove('active');
    }
    
    // Notification
    function showNotification(message, type = 'success') {
      notificationText.textContent = message;
      notification.style.background = type === 'error' ? 'var(--error)' : 'var(--success)';
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }
    
    // References, About, Help
    function showReferences() {
      const references = `
        <h3>منابع علمی</h3>
        <ul>
          <li>کتاب "المعجم في ابجد الحروف" - ابن الندیم</li>
          <li>کتاب "ابجد و حساب" - دکتر محمدجواد باقری</li>
          <li>"The Mystical Qabalah" - Dion Fortune</li>
          <li>"Gematria: The Hidden Meaning of Words" - Rabbi Yitzchak Ginsburgh</li>
          <li>مقاله "Numerical Symbolism in Islamic Mysticism" - Journal of Islamic Studies</li>
          <li>مقاله "The Abjad System in Classical Arabic Texts" - Journal of Semitic Studies</li>
        </ul>
      `;
      
      alert(references);
    }
    
    function showAbout() {
      alert(`ماشین حساب ابجد حرفه‌ای
نسخه 1.0.0
      
این برنامه برای محاسبه ارزش عددی حروف در زبان‌های مختلف
با استفاده از روش‌های علمی و معتبر طراحی شده است.
      
ویژگی‌ها:
• پشتیبانی از 4 زبان
• 12 روش محاسبه مختلف
• امکان ایجاد الگوهای سفارشی
• تحلیل عددی و معنایی
• ذخیره‌سازی آفلاین`);
    }
    
    function showHelp() {
      alert(`راهنمای استفاده:
      
1. زبان مورد نظر را انتخاب کنید
2. روش محاسبه را انتخاب کنید
3. متن خود را وارد کنید
4. دکمه "محاسبه ابجد" را بزنید
      
نکات:
• برای مقایسه روش‌ها از دکمه "مقایسه روش‌ها" استفاده کنید
• می‌توانید الگوهای سفارشی خود را تعریف کنید
• تاریخچه محاسبات به صورت خودکار ذخیره می‌شود`);
    }
  </script>
</body>
</html>
